{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

    <script src="{% static "js/jquery-1.11.1.min.js" %}"></script>
    <link href="{% static 'css/cart_style.css'%}" rel="stylesheet">

    <div id="alert_msg" class="" style="display:none;"></div>

    <h2 class="col-md-10 col-md-offset-1">My Cart</h2>

    <table class="table table-hover">
        {% for product in products %}
            <tr id="row_{{ product.pk }}" class="row featurette">
                <td class="col-md-2 product_image"><img class="cartImg" src="{% static 'products' %}/{{ product.image_root }}"></td>
                <td class="col-md-6">
                    <div class="row featurette">
                        <p class="product_name"><a href="{% url 'design:product-view' product.pk %}">{{ product.product_name }}</a></p>
                        <p class="product_number">{{ product.product_code }}</p>
                        <p class="product_price">${{ product.price }}</p>
                    </div>
                </td>
                <td class="col-md-3">
                    <input class="form-control">
                </td>
                <td class="col-md-1"><button class="btn btn-default" onclick='remove_row("{{ product.pk }}")'>remove</button></td>
            </tr>
        {% endfor %}
    </table>
    <br>
    <a id="btnpay" href="{% url 'design:my-order' user.pk %}">Place to order</a>

    <script type="text/javascript">
        var host = window.location.origin;

        function remove_row(id){
            var row_id = "#row_" + id;
            remove_from_db(id);
            $(row_id).hide();
        }

        function remove_from_db(id){
            $.ajax({
            type: "POST",
            url: host + "/api/cart/" + id + "/remove/",
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){
                request_success();
            }).fail(function(jqXHR, textStatus){
                request_failed();
            });
        }

        function request_success(){
            $("#alert_msg").attr("class", "alert alert-success").html("action success !").fadeIn(1000, 0).fadeOut(2000, 0);
        }

        function request_failed(){
            $("#alert_msg").attr("class", "alert alert-warning").html("action failed, please login !").fadeIn(1000, 0).fadeOut(2000, 0);
        }

    </script>

{% endblock %}